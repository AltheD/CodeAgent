#### 一、Flask（轻量微内核 + 插件扩展）
- 架构风格
  - 微内核（Microkernel）：核心极小，负责路由与请求分发。
  - 插件化扩展：通过 Blueprint 挂载模块（路由、过滤器、静态资源、模板）。
  - 适配器：WSGI 适配 Web 服务器；Jinja2 模板作为视图层。
- 关键组件
  - `Flask`（核心应用对象）、`Blueprint`（模块/插件）、`Request/Response`、`Jinja2Environment`、Werkzeug 路由/WSGI。
- 核心设计模式
  - Microkernel、Decorator（`@app.route`）、Factory（`create_app`）、Adapter（WSGI/模板）、Registry（路由表）。
- 典型流程
  - Request → 路由匹配（核心）→ 调用蓝图注册的视图函数 → 渲染模板/返回 Response。
- 类图对应点
  - `Flask --> Blueprint`（聚合）、`Flask --> Request/Response/Jinja2Environment`（依赖）、Blueprint 暴露路由装饰器。
- 适合 Agent 测试点
  - 路由冲突/覆盖、模板变量未定义、扩展版本不兼容、WSGI 中间件顺序问题、安全配置（Debug/Secret/CSRF）。

#### 二、Django（全栈 MVT + 中间件责任链）
- 架构风格
  - MVT：Model（ORM）- View - Template；与 MVC 同宗。
  - Pipe & Filter：Middleware 责任链处理请求/响应。
  - 插件化：App/Signals 可扩展。
- 关键组件
  - `HttpRequest/HttpResponse`、`MiddlewareMixin`、`URLResolver`、`View（CBV/FBV）`、`Model/Manager/QuerySet`、Migrations。
- 核心设计模式
  - MVC/MVT、Chain of Responsibility（中间件）、Active Record + Query Builder（ORM）、Template Method（CBV 钩子）、Inversion of Control（App/Signals）。
- 典型流程
  - Request → Middleware 链 → URLResolver → View.dispatch → ORM/Template → Response → Middleware 链。
- 类图对应点
  - `MiddlewareMixin --> HttpRequest/HttpResponse`、`URLResolver --> View`、`Model --> Manager --> QuerySet`。
- 适合 Agent 测试点
  - 路由优先级/冲突、ORM 生成 SQL 异常、模板上下文/变量错误、中间件顺序/安全配置（CSRF、DEBUG）、迁移一致性。

#### 三、Pandas（分层 + 数据内核与可插拔类型）
- 架构风格
  - 分层：API 层（DataFrame/Series）→ 逻辑层 → 存储层（Block/ArrayManager）→ 基础（NumPy/Cython）。
  - 微内核：`NDFrame` 为共同基类；类型扩展通过 `ExtensionArray` 插件化。
- 关键组件
  - `NDFrame/Series/DataFrame`、`Index`、`BlockManager/Block`（或 ArrayManager）、`ExtensionArray`、I/O 模块。
- 核心设计模式
  - Facade（DataFrame 封装底层存储）、Strategy（合并/聚合策略）、Template Method（groupby/rolling 骨架）、Adapter（多种 I/O 格式）、Flyweight（Index 共享/不可变）。
- 典型流程
  - 高层 API（如 `df.merge`）→ 内部选择策略 → 访问底层块/数组并执行变换 → 返回新 NDFrame。
- 类图对应点
  - `NDFrame <|-- DataFrame/Series`、`DataFrame *-- BlockManager`、`BlockManager *-- "1..*" Block`、`Series o-- ExtensionArray`、`NDFrame o-- Index`。
- 适合 Agent 测试点
  - dtype/对齐问题、索引操作、时间序列边界、I/O 转换一致性、性能退化。

---

### “Microkernel core with plugin-like extensions via Blueprints” 
- 微内核核心，通过蓝图以“插件式”扩展功能。
- 解释（以 Flask 为例）：
  - 核心（微内核）只提供最小能力：路由注册、请求到视图函数的分发。
  - 蓝图（Blueprint）像插件：每个业务模块自带路由、钩子、模板、静态资源，通过注册挂到核心上。
  - 优点：核心稳定、模块隔离、按需装配、适合大型应用分治。

---

### “Facade over BlockManager/ArrayManager”
- DataFrame 充当外观（Facade），把底层的存储管理器 BlockManager/ArrayManager 的复杂性屏蔽起来。
- 对外只暴露表格化的高层 API（如 merge/groupby/loc/iloc），让使用者无需关心底层块/数组的组织与操作细节。

---

### 模式-证据对照（按课程要求补充）
- Flask：
  - Microkernel（证据）`Flask` 仅负责路由/分发；功能靠 `Blueprint` 组合。
  - Decorator（证据）`@app.route`、`@before_request` 注册行为。
  - Adapter（证据）WSGI 与 Jinja2 的对接。
- Django：
  - Chain of Responsibility（证据）`MiddlewareMixin` 形成请求/响应责任链。
  - Active Record + Query Builder（证据）`Model` + `Manager` + `QuerySet`。
  - Template Method（证据）CBV 的 `dispatch/get/post` 钩子。
- Pandas：
  - Facade（证据）`DataFrame` 封装 `BlockManager/ArrayManager`。
  - Strategy（证据）合并/聚合等策略化实现（如 merge how）。
  - Adapter（证据）多种 I/O 格式到统一 API。

---

### 典型流程（条列版，便于转成时序图）
- Flask 请求流程：Request → Router → Blueprint 视图 → 模板渲染 → Response
- Django 请求流程：Request → Middlewares → URLResolver → View.dispatch → ORM/Template → Response → Middlewares
- Pandas API 流程：`df.merge` → 选择策略 → 访问 Block/Array → 结果组装成新 NDFrame

---

### 对 CodeAgent 的借鉴（详细落地）
- 架构风格：
  - 微内核：`Coordinator/TaskManager` 作为稳定内核；`Detector/Analyzer/RuleSet` 以插件注册与启用。
  - 责任链：上传→校验→解压→入队→执行→聚合→持久化→导出，拆分为中间件，记录耗时/错误，便于插拔与监控。
  - 外观：API 统一“上传/任务/状态/结果”，对内屏蔽不同工具差异。
- Detector 接口（Strategy + Adapter）：
  - 统一签名：`detect(project_path) -> List[Issue]`
  - Issue 结构：`{ ruleId, severity, file, line, message, sourceTool }`
  - 工具映射：pylint/flake8/bandit/semgrep → 归一化为 Issue；在适配层完成字段转换与分级。
- API 外观（Facade）：
  - POST `/api/upload` → `{ uploadId }`
  - POST `/api/tasks`（`{ uploadId, taskType: "static_scan" }`）→ `{ taskId }`
  - GET `/api/tasks/{taskId}/status` → `{ status, progress }`
  - GET `/api/tasks/{taskId}/results` → `{ issues, totals, artifacts? }`
- 编排与可用性：
  - 并发与超时：线程/进程池大小、子进程超时、重试策略。
  - 安全解压：拒绝 `..` 与绝对路径、限制大小/类型、MIME 校验。
  - 观测：任务时长、失败率、规则命中分布；结构化日志。

---

### 对 CodeAgent 的借鉴：
  - 参考 Flask 微内核：把 `Detector/Analyzer` 做成插件；协调器为核心。
  - 参考 Django 责任链：任务的校验/调度/汇总做中间件式管道。
  - 参考 Pandas Facade：对外提供统一扫描接口，内部封装不同工具链。
### 后续可补充（建议）
- `docs/api.md`：详细 API 入参/出参/示例 curl。
- `docs/detector-interface.md`：Issue 字段说明、工具到 Issue 的映射表。
- `docs/architecture.md`：CodeAgent 的容器/组件图与中间件流程图。
