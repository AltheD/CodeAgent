# 测试缺陷项目使用指南

## 项目概述

`test_defect_project.zip` 是一个专门用于测试动态检测功能的有缺陷项目。该项目包含了多种类型的代码缺陷，用于验证动态检测系统的检测能力。

## 项目结构

```
test_defect_project.zip
├── syntax_errors.py          # 语法错误
├── security_issues.py        # 安全问题
├── performance_issues.py     # 性能问题
├── logic_errors.py          # 逻辑错误
├── code_quality_issues.py   # 代码质量问题
├── working_code.py          # 正常代码
├── config.py                # 配置文件
├── requirements.txt         # 依赖文件
├── test_defect_project.py   # 测试文件
└── README.md                # 项目说明
```

## 缺陷类型详解

### 1. 语法错误 (syntax_errors.py)
- **缺少冒号**: `if True` 应该是 `if True:`
- **未定义变量**: 使用未定义的 `undefined_variable`
- **缩进错误**: 不正确的代码缩进
- **预期检测结果**: 静态分析应该能检测到这些语法错误

### 2. 安全问题 (security_issues.py)
- **eval() 使用**: `eval(user_input)` - 执行任意代码
- **exec() 使用**: `exec(code)` - 执行任意代码
- **pickle 反序列化**: `pickle.loads(data)` - 可能执行恶意代码
- **命令注入**: `os.system(f"cat {filename}")` - 命令注入漏洞
- **SQL注入**: `f"SELECT * FROM users WHERE id = {user_id}"` - SQL注入漏洞
- **预期检测结果**: 静态分析应该标记这些安全风险

### 3. 性能问题 (performance_issues.py)
- **低效循环**: 使用 `append()` 而不是列表推导式
- **阻塞操作**: `time.sleep(10)` - 长时间阻塞
- **内存泄漏**: 大量内存占用
- **低效字符串拼接**: 使用 `+=` 而不是 `join()`
- **同步请求**: 应该使用异步请求
- **无限递归**: `infinite_recursion()` - 可能导致栈溢出
- **预期检测结果**: 静态分析和运行时分析应该检测到性能问题

### 4. 逻辑错误 (logic_errors.py)
- **除零错误**: `a / b` 当 `b = 0` 时
- **索引越界**: `my_list[10]` 当列表只有3个元素时
- **类型错误**: `number + text` 数字加字符串
- **键错误**: 访问不存在的字典键
- **属性错误**: 访问 `None` 对象的属性
- **值错误**: `int("not_a_number")`
- **文件不存在**: 打开不存在的文件
- **预期检测结果**: 运行时分析应该检测到这些错误

### 5. 代码质量问题 (code_quality_issues.py)
- **函数名不够描述性**: `bad_function_name()`
- **函数过长**: `long_function()` 超过50行
- **重复代码**: 相同的逻辑重复出现
- **魔法数字**: 硬编码的数字 `100`, `50`, `1.5`
- **未使用的导入**: 导入了但不使用的模块
- **不一致的格式**: 代码格式不统一
- **缺少文档字符串**: 函数没有说明文档
- **参数过多**: 函数有10个参数
- **预期检测结果**: 代码质量分析应该检测到这些问题

### 6. 正常代码 (working_code.py)
- **正常函数**: 标准的Python函数实现
- **文档字符串**: 有完整的函数说明
- **类型提示**: 清晰的参数和返回值
- **预期检测结果**: 应该没有检测到问题

## 使用方法

### 1. 启动API服务
```bash
python start_api.py
```

### 2. 访问前端界面
打开浏览器访问: `file://frontend/index.html`

### 3. 选择动态检测功能
点击"动态检测"卡片

### 4. 上传测试文件
选择 `test_defect_project.zip` 文件

### 5. 配置检测选项
- ✅ 启用静态分析
- ✅ 启用动态监控
- ✅ 启用运行时分析

### 6. 开始检测
点击"开始检测"按钮

### 7. 查看结果
等待检测完成，查看检测报告

## 预期检测结果

### 静态分析结果
- **语法错误**: 检测到多个语法问题
- **安全问题**: 标记eval/exec使用、命令注入等
- **代码质量问题**: 函数过长、重复代码、魔法数字等
- **性能问题**: 低效循环、字符串拼接等

### 运行时分析结果
- **逻辑错误**: 除零、索引越界、类型错误等
- **执行异常**: 文件不存在、网络错误等
- **性能问题**: 内存使用、执行时间等

### 动态监控结果
- **系统资源**: CPU、内存使用情况
- **性能指标**: 响应时间、吞吐量等
- **异常告警**: 系统异常检测

## 检测报告示例

```json
{
  "summary": {
    "overall_status": "warning",
    "total_issues": 25,
    "critical_issues": 5,
    "warning_issues": 15,
    "info_issues": 5,
    "issues_by_type": {
      "syntax_error": 3,
      "security_issue": 5,
      "performance_issue": 6,
      "logic_error": 7,
      "code_quality": 4
    }
  },
  "recommendations": [
    "发现严重问题，建议立即修复",
    "发现安全问题，建议加强安全防护",
    "发现性能问题，建议优化性能",
    "发现代码质量问题，建议重构代码"
  ]
}
```

## 测试验证

### 验证静态分析
- 检查是否检测到语法错误
- 检查是否标记安全问题
- 检查是否发现代码质量问题

### 验证运行时分析
- 检查是否捕获执行异常
- 检查是否检测到逻辑错误
- 检查是否监控性能问题

### 验证动态监控
- 检查是否监控系统资源
- 检查是否生成性能报告
- 检查是否发送异常告警

## 故障排除

### 常见问题
1. **检测时间过长**: 正常，因为包含多种缺陷类型
2. **部分检测失败**: 某些缺陷可能无法在测试环境中触发
3. **结果不完整**: 检查API服务是否正常运行

### 调试建议
1. 查看API服务日志
2. 检查浏览器控制台
3. 验证文件上传是否成功
4. 确认检测选项配置正确

## 扩展测试

### 创建更多测试用例
可以基于这个项目创建更多测试用例：
- 不同编程语言的缺陷
- 更复杂的安全漏洞
- 更严重的性能问题
- 更隐蔽的逻辑错误

### 自定义检测规则
可以根据需要调整检测规则：
- 修改安全检测阈值
- 调整性能监控参数
- 自定义代码质量标准

---

**测试项目版本**: 1.0.0  
**创建时间**: 2024年12月  
**文件大小**: 5.70 KB  
**包含文件**: 10个  
**缺陷类型**: 5种  
**预期问题数**: 25+个
